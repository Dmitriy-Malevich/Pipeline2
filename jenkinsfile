properties([pipelineTriggers([githubPush()])])
pipeline {
    agent {
        label 'ubuntu_slave'
}
//    triggers {
//	properties([pipelineTriggers([githubPush()])]) }    

    stages {
//	stage('Checkout SCM') {
//            steps {
//		checkout([
//                 $class: 'GitSCM',
//                 branches: [[name: 'main']],
//                 userRemoteConfigs: [[
//                    url: 'git@github.com:Dmitriy-Malevich/Pipeline2.git',
//                    credentialsId: '',
//                 ]]
//                ])
//            }
//        }
        stage('Build Image1') {
            steps {
                sh 'docker build -t dmitriy228/my-app .'
            }
        }
        stage('Run Container') {
            steps {
                sh 'docker run -d dmitriy228/my-app'
            }
        }
	stage('Docker login & run docker') {
            steps {
                echo "=============== docker login==============="
		withCredentials([usernamePassword(credentialsID: 'Dockerhub-login' , usernameVariable: 'USERNAME' , passwordVariable: 'PASSWORD')]) {
		sh """
		docker login -u $USERNAME -p $PASSWORD
		"""
		sh 'docker run -d dmitriy228/my-app'
            }
        }
}

        stage('Deploy') {
            steps {
		sh 'pwd'
		sh 'hostname'
		sh 'docker push dmitriy228/my-app'
            }
        }
    }
}
